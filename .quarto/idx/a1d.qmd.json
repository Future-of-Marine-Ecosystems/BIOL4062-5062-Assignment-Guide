{"title":"**Assignment 1d:** Multiple Linear Regression","markdown":{"headingText":"**Assignment 1d:** Multiple Linear Regression","containsRefs":false,"markdown":"\nThis assignment is all about multiple linear regression. Linear regression is used to model relationships between a dependent (response) variable and one or more independent (predictor) variables. Multiple linear regression involves multiple predictor variables.\n\nFor this tutorial we're going to use `Schoenemann.csv`, derived from the data in [this](https://doi.org/10.1159/000073759) paper.\n\n## Looking at the data\n\n```{r}\n# Read in data\ndata = read.csv('Schoenemann.csv')\n\n# View data structure\nhead(data)\ndim(data)\n```\n\nThe Schoenemann dataset contains 39 observations of 12 variables, describing to the morphometry of different species of mammals, along with taxonomic and location information. Let's start by getting rid of the non-morphological data. We won't need it for this assignment.\n\n```{r}\n# Remove metadata\ndata = data[,which(colnames(data) == 'Mass'):ncol(data)] # I do it this way to avoid hard coding a number which may change\n\n# check if it worked\nhead(data)\n```\n\nNow we only have the numeric morphologicall data left. Let's take a look at the data graphically.\n\n```{r}\n# Visualize the data\nboxplot(data)\n\n# Loop through columns to create histograms\nfor(i in 1:ncol(data)){hist(data[,i], main = colnames(data)[i], xlab = \"\")} # Name histogram according to column name\n```\n\n## Considering Transformations\n\nWe can see that these data have many more small values, and the data at higher values has higher variance \\[try e.g. plot(data\\$Mass, data\\$Fat) to see this\\]. If we run our regressions on these data, the assumption of heteroscedasticity is going to be violated:\n\n```{r}\n# Run a test model and check assumptions\ntest = lm(CNS ~ Mass + Fat + FFWT + HEART + MUSCLE + BONE, data = data)\n\n# Check for normality as an example\n\n# Residual histogram\nhist(residuals(test), 20)\n\n# QQplot\nqqnorm(residuals(test))\n\n# Statistical test for normality\nshapiro.test(residuals(test))\n```\n\nThese diagnostics look... less than ideal.\n\nThis is a textbook case of when to apply a log transformation to standardize variance - remember logging is the opposite of exponentiating:\n\n```{r}\n# Apply log transformation\ndata_l = log(data)\n\n# Check out the new data\nhead(data_l)\n\n# Looking at the data\nboxplot(data_l)\n\n# Loop through columns to create histograms\nfor(i in 1:ncol(data_l)){hist(data_l[,i], main = colnames(data_l)[i], xlab = \"\")} # Name histogram according to column name\n```\n\nNow our data looks much more uniform.\n\n**Always remember that transforming your data incorrectly or unnecessarily can do more harm than good.** How do you decide if it is helpful to transform your data? What is the purpose of transforming your data? Think carefully about these questions for your assignment when you're deciding whether to transform any data.\n\n## Simple Linear Regression\n\nNow that our data is good to go, we're going to run some simple linear regressions on the logged data to predict central nervous system mass (CNS). Simple linear regressions only have one predictor variable, so we will run separate models for each predictor. Linear regression is run using the `lm()` command:\n\n```{r}\n# Run simple linear regressions - Mass\nm1 = lm(CNS ~ Mass, data = data_l) # run model\nsummary(m1) # model summary\n\n# Run simple linear regressions - Fat\nm2 = lm(CNS ~ Fat, data = data_l) # run model\nsummary(m2) # model summary\n\n# Run simple linear regressions - FFWT\nm3 = lm(CNS ~ FFWT, data = data_l) # run model\nsummary(m3) # model summary\n\n# Run simple linear regressions - HEART\nm4 = lm(CNS ~ HEART, data = data_l) # run model\nsummary(m4) # model summary\n\n# Run simple linear regressions - MUSCLE\nm5 = lm(CNS ~ MUSCLE, data = data_l) # run model\nsummary(m5) # model summary\n\n# Run simple linear regressions - BONE\nm6 = lm(CNS ~ BONE, data = data_l) # run model\nsummary(m6) # model summary\n\n```\n\nIn this case, it looks like all of our variables are strong, significant predictors with high R^2^ values.\n\nLet's plot all of these regressions:\n\n```{r}\n# Plot regressions\n\n# Plot simple linear regressions - Mass\nplot(CNS ~ Mass, data = data_l, pch = 16) # plot points\nabline(m1, lwd = 2, col = 'red') # Plot model\n\n# Plot simple linear regressions - Fat\nplot(CNS ~ Fat, data = data_l, pch = 16) # plot points\nabline(m2, lwd = 2, col = 'red') # Plot model\n\n# Plot simple linear regressions - FFWT\nplot(CNS ~ FFWT, data = data_l, pch = 16) # plot points\nabline(m3, lwd = 2, col = 'red') # Plot model\n\n# Plot simple linear regressions - HEART\nplot(CNS ~ HEART, data = data_l, pch = 16) # plot points\nabline(m4, lwd = 2, col = 'red') # Plot model\n\n# Plot simple linear regressions - MUSCLE\nplot(CNS ~ MUSCLE, data = data_l, pch = 16) # plot points\nabline(m5, lwd = 2, col = 'red') # Plot model\n\n# Plot simple linear regressions - BONE\nplot(CNS ~ BONE, data = data_l, pch = 16) # plot points\nabline(m6, lwd = 2, col = 'red') # Plot model\n\n```\n\nAll of the regression slopes are positive. This makes sense - larger animals tend to have larger brains. Remember to always think about whether your results make biological sense.\n\n## Multiple Linear Regression\n\nWe've made 6 models using 1 variable. Now, let's try making 1 model with 6 variables:\n\n```{r}\n# Run full model\nm7 = lm(CNS ~ Mass + Fat + FFWT + HEART + MUSCLE + BONE, data = data_l)\nsummary(m7)\n```\n\nOur full model has a very(!) high R^2^ value, and, in contrast to the simple linear regressions where every predictor was significant, none of our predictors are considered significant in the final model at $\\alpha$ = 0.05. Why do you think that is?\n\n## Checking Assumptions\n\nNow that we've run our full model, it's time to check its assumptions. Those assumptions are **Independence, Linearity, Homoscedasticity, and Normality.** By now, you should be familiar with what these all mean, but let's run through them anyways:\n\n### Independence\n\nThe assumption of independence states that the value of each data point ('datum', if you will) is independent of all other data points. Some of the ways in which it could be violated may not be testable (e.g. if they have to do with how the data was collected), but what we *can* test for is **autocorrelation**. Autocorrelation translates to self correlation (auto = self). We can test for autocorrelation statistically using a Durbin-Watson test, and visually using an autocorrelation function on the residuals:\n\n```{r}\nlibrary(lmtest)\n\n# Durbin-watson test\ndwtest(m7)\n\n# Autocorrelation function\nacf(residuals(m7))\n```\n\nThe Durbin-Watson test returns an insignificant p-value, indicating no autocorrelation structure is present. The ACF plots the correlation coefficient of the data against itself using lags. Lag 0 correlates the data against itself, which is always 1. Lag 1 correlates each data point against the point after it, and so on. All of the correlation coefficients are between the blue lines, so again, we have no autocorrelation structure, and we can say independence is respected.\n\n### Linearity\n\nThe assumption of linearity states that the response variable consistently scales linearly with its predictors. We can test for linearity statistically using Ramsey's RESET test on our model:\n\n```{r}\n# Run RESET test\nresettest(m7)\n```\n\nIn this case, the p-value is not significant, meaning the assumption of linearity is respected.\n\n### Homoscedasticity\n\nThe assumption of homoscedasticity is that the variance in the data is independent of the value of the data - i.e. the variance in the data is consistent. We can test this statistically using the Breusch-Pagan test, and visually by plotting the model residuals against the fitted values.\n\n```{r}\n# Run Breusch-Pagan test\nbptest(m7)\n\n# Plot residuals vs fitted\nplot(m7$residuals ~ m7$fitted.values, pch = 16); abline(h = 0)\n\n# Can also be done using plot.lm, ?plot.lm for details\nplot(m7, 1)\n```\n\nThe Breusch-Pagan returns a significant p-value, indicating the assumption of homoscedasticity is violated. We can see in the residuals versus fitted plot that the variance in the data is smaller at low values than it is at higher values (the points on the left of the plot are clustered more closely than they are on the right). Let's come back to this later.\n\n### Normality\n\nThe assumption of normality states that the residuals of our model should be normally distributed. If they aren't, that would indicate that our model is biased towards overprediction or underprediction in some way. As we did earlier in the transformation section, we can check for normality visually by looking at histograms and QQ plots of our residuals, and statistically by running a Shapiro-Wilk test on the residuals.\n\n```{r}\n# Residual histogram\nhist(residuals(m7))\n\n# QQplot\nqqnorm(residuals(m7))\n\n# Can also use plot.lm for qqplot\nplot(m7, 2)\n\n# Statistical test for normality\nshapiro.test(residuals(m7))\n```\n\nThe Shapiro-Wilk test p-value is not significant (though it comes close), meaning the assumption of normality is respected. The residual histogram largely looks normal, and the QQ plot tails start to pull off the line at high and low values, possibly indicating outliers are causing us some trouble, but not enough to violate the assumption.\n\n### What if my assumptions aren't respected?\n\nThe typical fixes for violated assumptions are data transformations, and the removal of outliers. In our case, we pass all assumptions except for homoscedasticity. We've already transformed our data to meet the assumption of normality, so further transformation is likely off the table, though we could potentially try different transformations. We could also try outlier removal - our model diagnostics using `plot.lm()` identify three outliers - 19, 20, and 28. Feel free to play around with removing outliers if you want, although in general it is good practice to only remove outliers where absolutely necessary, as they may contain important biological or other information.\n\nKeep in mind that data transformations and removing outliers both represent trade-offs. Removing outliers may help meet your model assumptions, but you may also be removing data that reflects reality from your model. In that case, is it really helping you to remove outliers? Similarly, transforming your data may help you meet your assumptions, but in a case like this, transforming our data further or in a different way could end up violating other assumptions. Sometimes the best way to deal with violated assumptions is simply to state that they are violated and think about what that means for the interpretation of your model. Play around with all these different ideas, and come up with what you think is best. At the end of the day, a lot of statistical choices are judgement calls, with no perfect right answer.\n\n## Model Selection\n\nIn assignment 1b, we created 1 model with 6 variables, then tested if we could get a similarly effective mode using fewer variables - i.e. a more **efficient** model. Let's do the same thing here:\n\n```{r}\n# Stepwise model selection - forward\nm8 = step(lm(CNS ~1, data = data_l),\n          scope=(CNS ~ Mass + Fat + FFWT + HEART + MUSCLE + BONE),\n          direction='forward')\nsummary(m8)\n```\n\nRunning forward model selection cuts the model down to 3 variables. As with 1b, we can also do backward:\n\n```{r}\n# Stepwise model selection - backwards\nm9 = step(m7, direction = 'backward')\nsummary(m9)\n```\n\nAnd both:\n\n```{r}\n# Stepwise model selection - both\nm10 = step(m7, direction = 'both')\nsummary(m10)\n```\n\nIf you want to get fancy, we can even look at every possible model\n\n```{r}\nlibrary(MuMIn)\n\n# Set global options to avoid error\noptions('na.action' = na.fail)\n\n# Run dredge to get full selection table\ndredge(m7, rank = 'AIC')\n```\n\nHere, we're ranking models by AIC. AIC balances fit with model complexity. Lower values of AIC are considered better. Generally, 2 is used as a rule of thumb for delta AIC: if delta AIC is \\>2, the model with the higher AIC value has little support. If delta AIC is \\<2, there is at least some support for the model with the higher AIC.\n\n## Tips for your Assignment:\n\nSome things you may want to think about for your assignment:\n\n1.  What role is collinearity playing in your assignment? Is it something you should be concerned about? Why or why not?\n\n2.  What does it mean if your assumptions are violated? How would you fix it? Is it worth fixing it? Why or why not?\n\n3.  How would you interpret your statistical results biologically? You don't have to be right, but don't be vague, and don't contradict your results.\n","srcMarkdownNoYaml":""},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":"auto","echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","output-file":"a1d.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.6.42","editor":"visual","theme":{"light":"cosmo","dark":"darkly"}},"extensions":{"book":{"multiFile":true}}},"pdf":{"identifier":{"display-name":"PDF","target-format":"pdf","base-format":"pdf"},"execute":{"fig-width":5.5,"fig-height":3.5,"fig-format":"pdf","fig-dpi":300,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":"auto","echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"pdf","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":true,"merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"pdf-engine":"xelatex","standalone":true,"variables":{"graphics":true,"tables":true},"default-image-extension":"pdf","to":"pdf","output-file":"a1d.pdf"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"block-headings":true,"editor":"visual","documentclass":"scrreprt"},"extensions":{"book":{"selfContainedOutput":true}}}},"projectFormats":["html","pdf"]}