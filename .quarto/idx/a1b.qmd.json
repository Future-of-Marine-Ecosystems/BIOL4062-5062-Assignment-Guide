{"title":"**Assignment 1b:** Linear Discriminant Analysis","markdown":{"headingText":"**Assignment 1b:** Linear Discriminant Analysis","containsRefs":false,"markdown":"\nAssignment 1b focuses on Linear Discriminant Analysis (LDA), also known as Canonical Variate Analysis. LDA is used to disclose relationships between groups, create models to differentiate between groups based on data, and discern the contribution of different variables to a model's ability do discriminate between groups.\n\nFor this tutorial, we'll be using `snake.csv`.\n\n## Looking at the data\n\n```{r}\n# Load in data\nsnake = read.csv('snake.csv')\n\n# Look at data\nhead(snake)\ndim(snake)\n```\n\nOur data is a 35 row, 7 column data frame. The first column identifies the species of snake (A or B). The other columns are morphological measurements of each individual snake. We want to know if we can use the morphological measurements of the snakes to determine their species. Let's keep examining the data:\n\n```{r}\n# Make a boxplot\nlibrary(tidyverse)\n\n# Convert the data to long format so we can use ggplot\nsnake_long = pivot_longer(snake, # Enter data\n                          colnames(snake)[-1], # Pivot all columns except species\n                          names_to = 'Measurement', values_to = 'Value') # Feed labels to new data frame\n\n# Lets take a look at the new data frame\nhead(snake_long)\n# We've converted from wide format to long format,\n# now all the data values are contained in a single column\n# which is described by a metadata column\n\n# You can also do this with melt from reshape2\nlibrary(reshape2)\nhead(melt(snake))\n\n# Let's make a boxplot\nggplot(snake_long, aes(x = Measurement, y = Value, fill = Species)) +\n  geom_boxplot() + theme_classic()\n\n# We can do this in R base plot too\nboxplot(Value ~ Species*Measurement, # Plot value by species and measurement\n        data = snake_long, col = c('coral', 'turquoise2'), # Color by species\n        xaxt = 'n', xlab = 'Measurement') # Remove and label x axis\nlegend('topleft', legend = c('Species A', 'Species B'), fill = c('coral', 'turquoise2')) # Add a legend\naxis(1, at = seq(1.5,11.5,2), labels = colnames(snake)[-1]) # Add x axis back in with appropriate labels\n\n```\n\nSome of our measurements are very similar across species, and others are quite different. Do they differ statistically as a whole?\n\n## MANOVA\n\nThe purpose of LDA is to try to discriminate our snakes into species based on their measurements. However, that only makes sense to do if our two species of snake actually differ across the measurements. Our first step then is to discern whether our snake species differ as a multivariate whole. We'll do this using a MANOVA.\n\n```{r}\n# Run MANOVA\nsm = manova(cbind(M1,M2,M3,M4,M5,M6) ~ Species, data = snake)\nsummary(sm, test = 'Hotelling')\nsummary(sm, test = 'Wilks')\n```\n\nBy both the Hotelling's and Wilks' tests, our MANOVA is significant, indicating the snake species vary as a multivariate whole.\n\nWhat about our assumptions though? Our MANOVA assumptions are normality, linearity, and homogeneity of covariances. You've been told to assume the latter, so let's skip that one.\n\n```{r}\n# Testing normality\nlibrary(mvnormtest)\nmshapiro.test(t(sm$residuals))\n```\n\nUh oh, the residuals are significantly non-normal. Let's take a look at them visually:\n\n```{r}\n# Residual histogram\nhist(t(sm$residuals), breaks = 20)\n```\n\nVisually, our residuals actually look quite close to normal. There may be some slight skew, or outliers that are forcing our residuals to statistical non-normality. We might be able to fix this by removing multivariate outliers, or by transforming some of our data (feel free to play around with these ideas!), but based on the shape of our residuals, it is unlikely that our model is fatally biased, and we may end up doing more harm than good. Based on this, we can conclude that our two species have significantly different morphometries given the measurements provided.\n\n## Linear Discriminant Analysis\n\nNow that we've confirmed our species differ as a multivariate whole, we can try to use LDA to build a model to predict which species each snake belongs to based on its measurements.\n\n```{r}\n# LDA\nlibrary(MASS)\nldaf1 <- lda(Species ~ M1+M2+M3+M4+M5+M6, snake)\nldaf1\n```\n\nRunning our LDA object tells us the prior probabilities used for each species (the proportion of each species in the data), the group means for each measure on each species, and the linear discriminant (LD1) for each measure. We can then plot the LD1 value for each individual:\n\n```{r}\n# Plot discriminant function analysis\n\n# Create a data frame to plot\nldaf_plot = cbind(snake, # Data\n                  predict(ldaf1)$x, # LD1 value for each individual given its measurements\n                  index = seq(1,nrow(snake), 1)) # Row/Individual number\n\n# Plot\nplot(LD1 ~ index, data = ldaf_plot, col = as.factor(snake$Species), pch = 16)\nlegend('topleft', legend = c('A', 'B'), col = c(1, 2), pch = 16) # Add legend\n```\n\nHere we can see higher LD1 values are associated with species B, while lower LD1 values are associated with species A. This is just based on model fit however; how do we know we aren't overfitting? One way to avoid overfitting is by jackknifing (AKA leave-one-out cross validation in this context). This method runs the model once without each point in the dataset, then calculates the posterior probability that the left out point belongs to each species. Let's try it out:\n\n```{r}\n# LDA 2, CV = T\nldaf2 = lda(Species ~ M1+M2+M3+M4+M5+M6, snake, CV = T)\n\n# Gather posteriors\nas.data.frame(cbind(ldaf2$posterior, # Pull posteriors from ldaf2\n                    ResultantSpp=as.character(ldaf2$class))) # Pull predicted species (i.e. species with the higher posterior probability)\n                                                             \n```\n\nHow does this differ from the predictions from our first model?\n\n```{r}\n# Pull ldaf1 model predictions\nldaf_pred = predict(ldaf1)$class\n\n# Gather Predictions\nldaf_diff = data.frame(ldaf1 = as.character(ldaf_pred), ldaf2 = as.character(ldaf2$class))\n\n# Add match column\nldaf_diff$match = (ldaf_diff$ldaf1 == ldaf_diff$ldaf2)\n\n# Which ones are different?\nldaf_diff[which(ldaf_diff$match == F),]\n\n```\n\nIndividuals 17 and 29 both differed in species prediction between the model fit and the jackknife posterior probability. Now let's check the accuracy of our model fit:\n\n```{r}\n# Calculate error\nldaf_wrong = length(which(ldaf_pred != snake$Species)) # Number of incorrect predictions\nldaf_err = ldaf_wrong/nrow(snake) # Divide by number of individuals for error\n\n# Print error\nldaf_wrong\nldaf_err\n\n```\n\nOur model classified 5 out of 35 (\\~14.3%) of the snakes as the incorrect species, meaning 30/35 were correct (\\~85.7%). Not bad, but can we do better?\n\n## Model Selection\n\nOur previous model used all 6 measurements, but do we really need all of them, or are some of them unhelpful (or even detrimental)? To test this, we can run model selection using the `stepclass()` function:\n\n```{r}\n# stepclass package\nlibrary(klaR)\n\n# Model selection (forward)\nms_f = stepclass(Species ~ M1+M2+M3+M4+M5+M6,data=snake,\n          method=\"lda\", fold=35, direction=\"forward\")\n\n# Print model selection result\nms_f\n```\n\nAfter model selection, we end up with a model using only M6 to predict species, with a correctness rate of 85.7%. This model has the same correctness as the full model, using only one measurement. In other words, this model is more **efficient** - it gets to the same accuracy using less information.\n\nThis model was generated using forward model selection, meaning the selection process works exclusively by adding variables to the model. We can also do the opposite:\n\n```{r}\n# stepclass package\nlibrary(klaR)\n\n# Model selection (forward)\nms_b = stepclass(Species ~ M1+M2+M3+M4+M5+M6,data=snake,\n          method=\"lda\", fold=35, direction=\"backward\")\n\n# Print model selection result\nms_b\n```\n\nBackwards model selection works by removing variables from the full model. This means backwards selection should always return a model with a equal or more variables than forwards selection.\n\nLastly, we can run both:\n\n```{r}\n# stepclass package\nlibrary(klaR)\n\n# Model selection (forward)\nms_d = stepclass(Species ~ M1+M2+M3+M4+M5+M6,data=snake,\n          method=\"lda\", fold=35, direction=\"both\")\n\n# Print model selection result\nms_d\n```\n\n## Plotting Probabilities\n\nLets finish off by making some plots to visualize our LDA model results.\n\n```{r}\n# Pick a model to plot\nldaf3 = lda(Species ~ M6, data = snake)\n\n# Plot density curve\nplot(ldaf3, dimen = 1, type = 'dens')\n```\n\nThis plots the posterior probabilites of an individual belonging to either species given its LD1 value. Remember from earlier that species A is associated with lower LD1 values.\n\nWe can also make this plot as a histogram:\n\n```{r}\n# Plot density curve\nplot(ldaf3, dimen = 1, type = 'hist')\n```\n\nOr combine both plots:\n\n```{r}\n# Plot density curve\nplot(ldaf3, dimen = 1, type = 'both')\n```\n\nAs always, we can also do this with ggplot too:\n\n```{r}\n# Predict species\nldaf3_pred = predict(ldaf3)\n\n# Plot\npred_species = as.data.frame(ldaf3_pred$x) # Gather LD1 values\npred_species$Species = snake$Species # Gather true species from data\n\n# Plot\nggplot(pred_species, aes(x = LD1, fill = Species))+\n  geom_density(alpha = 0.4)# alpha tells you how transparent the plots will be\n```\n\n## Tips for your assignment\n\nSome things you may want to think about for your assignment:\n\n1\\. How would you pick which model you think is best? What factors would you consider? Are there any factors you would consider other than those discussed in this tutorial?\n\n2\\. LDA also assumes the data are independent. Do we know this assumption is respected? Why or why not? What would constitute it not being respected?\n\n3\\. How would you interpret your statistical results biologically (can be in terms of the snakes, how you would study them, or both)? You don't have to be right, but don't be vague, and don't contradict your results.\n","srcMarkdownNoYaml":""},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true,"format-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","output-file":"a1b.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.3.450","editor":"visual","theme":"cosmo"},"extensions":{"book":{"multiFile":true}}},"pdf":{"identifier":{"display-name":"PDF","target-format":"pdf","base-format":"pdf"},"execute":{"fig-width":5.5,"fig-height":3.5,"fig-format":"pdf","fig-dpi":300,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"pdf","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":true,"merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"pdf-engine":"xelatex","standalone":true,"variables":{"graphics":true,"tables":true},"default-image-extension":"pdf","to":"pdf","output-file":"a1b.pdf"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items"},"metadata":{"block-headings":true,"editor":"visual","documentclass":"scrreprt"},"extensions":{"book":{"selfContainedOutput":true}}}},"projectFormats":["html","pdf"]}